<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>DEMO</title>
    <style media="screen">
      #demo-element {
        width: 400px;
      }
      body {
        overflow:hidden;
        height: 100vh;
        display: flex;
        justify-content: center;
      }

      li {
        background-color: white;
        border: 1px solid whitesmoke;
        font-size: 2em;
        padding: 30px;
        box-shadow: 0 5px 20px 0 #EEE;
        border-radius: 20px;
        margin: 1em 0;
        list-style-type: none;

        /*transition: transform 100ms linear;*/
      }
    </style>
  </head>
  <body>
    <ul id="demo-element">
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>
      <li>Item 1</li>
      <li>Item 2</li>
      <li>Item 3</li>
      <li>Item 4</li>
      <li>Item 5</li>
      <li>Item 10</li>
      <li>Item 11</li>
      <li>Item 12</li>
      <li>Item 13</li>
      <li>Item 14</li>

    </ul>

    <script src="tweenjs.js"></script>
    <script type="text/javascript">
      /** TODO
      * Implement bounce effect
      * Implement sluggish-effect on list elements
      * Add more input types (not only wheel)
      * Implement scroll bar

      * The core library should be as light as possible
      */

      // IDEA: Add velocity stack that gets dismantled over time. This could make acceleration very smooth (currently it is a bit junky)
      var box = document.getElementById("demo-element");
      var boxChildren = document.getElementsByTagName("li")
      var speed = 0; // in px/millisecond
      var friction = 0.0040; // in px/millisecond
      var totalDistance = 0;
      var isRunning = false;

      var frameTimeDelta = 0;
      var lastFrameTimeStamp = 0;

      var BOUNCE_THRESHOLD = 100;
      var MAX_SPEED = 4;

      function move (e) {
        // flip input (because it's the wrong way around)
        let deltaY = e.deltaY * -1;

        // Minimum speed to ensure snappy movement
        if (speed < 0.5 && speed > -0.5) {
          speed += deltaY/4;
        }
        else {
          speed += deltaY/15;
        }
        // Maximum speed limit
        if (speed > MAX_SPEED || speed < -MAX_SPEED) {
          speed = MAX_SPEED * Math.sign(speed);
        }

        // IDEA: Maybe there could be a AddMovemnt function (if things get more complex?)

        if (isRunning == false) {
          lastFrameTimeStamp = performance.now();
          isRunning = true;
          requestAnimationFrame(animate);
        }
      }

      function getDelta(timePassed) {
        // NOTE: This does not take into account all speed steps that may happen
        // during a long frame, so this is not always accurate
        return timePassed * speed;
      }
      function animate() {
        var currentFrameTimeStamp = performance.now();
        var frameTimeDelta = Math.floor(currentFrameTimeStamp - lastFrameTimeStamp);

        lastFrameTimeStamp = currentFrameTimeStamp;

        if (speed != 0) {
          requestAnimationFrame(animate);


          box.style.transform = `translateY(${totalDistance += getDelta(frameTimeDelta)}px)`;

          // NOTE: The following could be prettier (and more performant?)
          //       Maybe we could keep a variable that has speed's current sign
          // BUG: On Webkit/Blink browsers speed is WAY to fast
          speed = Math.sign(speed)==-1 ? Math.min(speed + friction * frameTimeDelta, 0) : Math.max(speed - friction * frameTimeDelta, 0);

          for (let i = 0; i < boxChildren.length; i++) {
            boxChildren[i].style.transform = `translateY(${speed*(-i*15)}px)`;
          }
        }

        if (speed == 0) {
          isRunning = false;
          return;
        }
      }

      document.addEventListener("wheel", move);

    </script>
  </body>
</html>
